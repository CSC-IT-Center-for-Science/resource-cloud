<div>
    <h1>Blueprints</h1>
    <div class="row row-flex row-flex-wrap">
        <div class="alert alert-warning" ng-hide="!blueprints || (blueprints | filter : {is_enabled: 'true'}).length">
            No blueprints available
        </div>
        <div ng-repeat="blueprint in blueprints | filter : { is_enabled: 'true' }" class="col-md-4 col-sm-6">
            <div class="panel panel-default flex-col">
                <div class="panel-heading">
                    <h3 class="panel-title">{{ blueprint.name }}</h3>
                </div>
                <div class="panel-body flex-grow">
                    <div>
                    <p>{{ blueprint.config.description }}</p>
                    <p><b>Maximum lifetime:</b> <lifetime seconds="{{ blueprint.maximum_lifetime }}"/> </p>
                    </div>
                </div>
                <div class="panel-footer text-center">
                    <a ng-click="provision(blueprint)" class="btn btn-block btn-primary" ng-disabled="blueprint.config.needs_ssh_keys && !keypair_exists()">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> Launch
                    </a>
                    <span ng-show="blueprint.config.needs_ssh_keys && keypairs && !keypair_exists()">
                        To launch instances, first <a href="/#/account">add SSH keys</a>.
                    </span>
                </div>
            </div>
        </div>
    </div>

    <h1>Instances</h1>
    <table class="table table-striped">
        <thead>
        <tr>
            <td>Access</td>
            <td>Name</td>
            <td>State</td>
            <td>Blueprint</td>
            <td ng-show="isAdmin()">User</td>
            <td>Life-time left</td>
            <td>Actions</td>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="instance in instances">
            <td>
                <a ng-show="instance.instance_data['endpoints'][0]['name']=='http'"
                   class="btn btn-primary" href="{{instance.instance_data['endpoints'][0].access}}" target="_blank">
                    Open in browser
                </a>
                <div ng-show="instance.instance_data['endpoints'][0]['name']=='SSH'">
                    {{ instance.instance_data['endpoints'][0].access }}
                </div>
            </td>
            <td><a href="#/instance_details/{{ instance.id }}"> {{instance.name}}</a></td>
            <td>{{instance.state}} {{ instance.error_msg ? " ("+instance.error_msg+")" : "" }}</td>
            <td>{{instance.blueprint}}</td>
            <td ng-show="isAdmin()">{{instance.owner}}</td>
           
            <td><lifetime seconds="{{instance.lifetime_left}}"/></td>
            <td>
                <button ng-click="deprovision(instance)" type="submit" class="btn btn-danger" ng-disabled="instance.state=='deleting'" >Destroy</button>
            </td>
        </tr>
        <tr ng-hide="instances.length || !instances">
            <td colspan="{{ isAdmin() ? 7 : 6 }}">No instances running</td>
        </tr>

        </tbody>
    </table>
</div>
